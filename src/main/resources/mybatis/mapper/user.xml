<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">
	<!-- Login -->
	<select id="getSecurityUser" parameterType="map" resultType="userdto">
		<![CDATA[
			SELECT
			user_email,
			user_password,
			cast(aes_decrypt(user_phone, #{keyValue}) as char) as phone,
			cast(aes_decrypt(user_addr1, #{keyValue}) as char) as addr1,
			cast(aes_decrypt(user_addr2, #{keyValue}) as char) as addr2,
			user_role
			FROM user
			WHERE user_email = #{username}
		]]>
	</select>
	
	<!-- Join duplication check -->
	<select id="getUserInfo" parameterType="string" resultType="userdto">
		<![CDATA[
			SELECT
			user_email
			FROM user
			WHERE user_email = #{email}
		]]>
	</select>
	
	<!-- join (user_role -> default -> if value is not exists, 'USER' will be set)-->
	<insert id="join" parameterType="userdto">
		<![CDATA[
			INSERT INTO USER
			VALUES
			(null,
            #{user_email}, 
            sha2(#{user_password}, 512),
            aes_encrypt(#{user_phone}, #{keyValue}),
            aes_encrypt(#{user_addr1}, #{keyValue}),
            aes_encrypt(#{user_addr2}, #{keyValue}),
            default)
		]]>
	</insert>
	
	
	
	
</mapper>